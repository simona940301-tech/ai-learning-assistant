# ğŸ‰ PLMS Solver-Only Mode - æœ€çµ‚ä¿®å¾©ç¸½çµ

**æ™‚é–“**: 2025-10-27T16:50:00+08:00  
**ç‹€æ…‹**: âœ… **æ‰€æœ‰ä¿®å¾©å·²å®Œæˆ**

---

## ğŸ“Š æ ¸å¿ƒå•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ

### å•é¡Œ 1: è‹±æ–‡é¡Œç›®é¡¯ç¤ºæ•¸å­¸ç­”æ¡ˆ âŒ

**æ ¹æœ¬åŸå› **: `lib/ai/hard-guard.ts` çš„æ­£å‰‡è¡¨é”å¼ç¼ºå°‘ `g` flagï¼Œå°è‡´ `matchAll()` å¤±æ•—

**ä¿®å¾©**:
```typescript
const MATH_PATTERN = /.../g  â† æ·»åŠ  g flag
const LATEX_PATTERN = /.../g  â† æ·»åŠ  g flag
```

**é©—è­‰**: âœ… ç§‘ç›®æª¢æ¸¬æ¸¬è©¦é€šé (English: 69%, Math: 80%, Chinese: 57%)

---

### å•é¡Œ 2: Monorepo çµ„ä»¶ç¼ºå¤± âŒ

**æ ¹æœ¬åŸå› **: Solve çµ„ä»¶åƒ…å­˜åœ¨æ–¼æ ¹ç›®éŒ„ï¼Œ`apps/web/` ä¸­ç¼ºå¤±

**ä¿®å¾©**:
```bash
cp -r components/solve/ apps/web/components/
cp lib/solve-types.ts apps/web/lib/
```

**é©—è­‰**: âœ… Next.js ç·¨è­¯æˆåŠŸï¼Œç„¡ "Module not found" éŒ¯èª¤

---

### å•é¡Œ 3: Warmup API æœªç¦ç”¨ âŒ

**æ ¹æœ¬åŸå› **: Warmup API ä»åœ¨é‹è¡Œ

**ä¿®å¾©**: API è¿”å› 410 Gone

**é©—è­‰**: âœ… `curl http://localhost:3000/api/warmup/keypoint-mcq-simple` è¿”å› 410

---

### å•é¡Œ 4: ç’°å¢ƒæª¢æŸ¥é‡è¤‡ âš ï¸

**æ ¹æœ¬åŸå› **: React Strict Mode å°è‡´ `useEffect` åŸ·è¡Œå…©æ¬¡

**ä¿®å¾©**: ä½¿ç”¨ `useRef` é˜²æ­¢é‡è¤‡åŸ·è¡Œ

**é©—è­‰**: âœ… Console åƒ…é¡¯ç¤ºä¸€æ¬¡ç’°å¢ƒæª¢æŸ¥

---

## âœ… å®Œæˆçš„æ‰€æœ‰å·¥ä½œ

1. **Hard Guard Bug ä¿®å¾©** - æ·»åŠ æ­£å‰‡è¡¨é”å¼ `g` flag
2. **ç§‘ç›®æª¢æ¸¬æ¸¬è©¦** - å‰µå»ºä¸¦é‹è¡Œè¨ºæ–·è…³æœ¬
3. **çµ„ä»¶åŒæ­¥** - è¤‡è£½ solve çµ„ä»¶å’Œé¡å‹åˆ° apps/web
4. **Warmup ç¦ç”¨** - API è¿”å› 410 Gone
5. **ç’°å¢ƒæª¢æŸ¥å„ªåŒ–** - é˜²æ­¢é‡è¤‡è¼¸å‡º
6. **æ–‡æª”å®Œå–„** - å‰µå»º 8 å€‹è©³ç´°æ–‡æª”
7. **é–‹ç™¼æœå‹™å™¨é‡å•Ÿ** - ç¢ºä¿æ–°ä»£ç¢¼ç”Ÿæ•ˆ

---

## ğŸ§ª é©—è­‰çµæœ

### Backend âœ…

```bash
# 1. Warmup API
$ curl -s -o /dev/null -w "%{http_code}" \
  http://localhost:3000/api/warmup/keypoint-mcq-simple
410 âœ…

# 2. ç§‘ç›®æª¢æ¸¬
$ npx tsx scripts/test-subject-detection.ts
âœ… English: 69.2% â†’ english
âœ… Math: 80.0% â†’ math
âœ… Chinese: 57.5% â†’ chinese

# 3. æœå‹™å™¨ç‹€æ…‹
$ lsof -ti:3000
Running on port 3000 âœ…
```

### Frontend â³

**éœ€è¦ç”¨æˆ¶åŸ·è¡Œ**:
1. ç¡¬åˆ·æ–°ç€è¦½å™¨ (`Cmd + Shift + R`)
2. è¼¸å…¥è‹±æ–‡é¡Œç›®æ¸¬è©¦
3. æª¢æŸ¥ Console è¼¸å‡º
4. ç¢ºèª UI é¡¯ç¤ºè©³è§£ï¼ˆä¸æ˜¯é¸æ“‡é¡Œï¼‰

---

## ğŸ“‹ ç”¨æˆ¶é©—è­‰æ­¥é©Ÿ

### ğŸ”„ Step 1: æ¸…é™¤ç·©å­˜ä¸¦ç¡¬åˆ·æ–°

```javascript
// åœ¨ç€è¦½å™¨ Console åŸ·è¡Œ
localStorage.clear()
sessionStorage.clear()
location.reload(true)
```

æˆ–æŒ‰å¿«æ·éµï¼š
- **Mac**: `Cmd + Shift + R`
- **Windows**: `Ctrl + Shift + F5`

---

### âœï¸ Step 2: è¼¸å…¥è‹±æ–‡é¡Œç›®

```
There are reports coming in that a number of people have been injured in a terrorist ___ . (A) access (B) supply (C) attack (D) burden
```

---

### âœ… Step 3: é©—è­‰è¼¸å‡º

#### Console æ‡‰è©²é¡¯ç¤º:

```javascript
âœ… [ForceSolver] Solver-only mode active
âœ… [API Guard] Global fetch guard installed
âœ… Guard: hard=none, experts=[english:0.69,...], chosen=english
âœ… Subject detection validated: english
âœ… Solve preview updated ...
```

#### UI æ‡‰è©²é¡¯ç¤º:

- âœ… **è©³è§£å¡ç‰‡**ï¼ˆä¸æ˜¯é¸æ“‡é¡Œï¼‰
- âœ… é ‚éƒ¨æœ‰ [è©³è§£ï½œç›¸ä¼¼é¡Œï½œé‡é»] ä¸‰å€‹ Chip
- âœ… å…§å®¹æ˜¯**è‹±æ–‡ç›¸é—œ**çš„è§£é‡‹
- âœ… **æ²’æœ‰**æ•¸å­¸å…¬å¼æˆ–é¸é …

#### ä¸æ‡‰è©²å‡ºç¾:

- âŒ "ä¸‹åˆ—å“ªä¸€å€‹æè¿°æœ€ç¬¦åˆ...ï¼Ÿ" é¸æ“‡é¡Œ
- âŒ æ•¸å­¸é¸é …ï¼ˆé¤˜å¼¦å®šç†ç­‰ï¼‰
- âŒ `[warmup-mcq]` Console æ—¥èªŒ

---

## ğŸ“ å‰µå»ºçš„æ–‡æª”

1. âœ… `CRITICAL_SUBJECT_FIX.md` - ç§‘ç›®æª¢æ¸¬å•é¡Œè¨ºæ–·
2. âœ… `SOLVER_ONLY_MODE_VERIFIED.md` - å®Œæ•´é©—è­‰å ±å‘Š
3. âœ… `ENV_CONFIGURED.md` - ç’°å¢ƒé…ç½®ç¢ºèª
4. âœ… `ENVIRONMENT_READY.md` - ç’°å¢ƒå°±ç·’ç‹€æ…‹
5. âœ… `CONSOLE_CHECKLIST.md` - Console æª¢æŸ¥æ¸…å–®
6. âœ… `FINAL_FIX_SUMMARY.md` - æœ¬æ–‡ä»¶
7. âœ… `scripts/test-subject-detection.ts` - ç§‘ç›®æª¢æ¸¬æ¸¬è©¦è…³æœ¬

---

## ğŸ¯ ä¿®å¾©å‰å¾Œå°æ¯”

### Before âŒ

```
ç”¨æˆ¶è¼¸å…¥: English question
â†“
âŒ Hard Guard å´©æ½° (regex éŒ¯èª¤)
â†“
âŒ é è¨­ä½¿ç”¨ Math
â†“
âŒ é¡¯ç¤ºæ•¸å­¸é¸æ“‡é¡Œ
```

### After âœ…

```
ç”¨æˆ¶è¼¸å…¥: English question
â†“
âœ… Hard Guard: subject=none
âœ… Experts: english=69.2%
âœ… Subject: english
â†“
âœ… é¡¯ç¤ºè‹±æ–‡è©³è§£
```

---

## ğŸ—ï¸ Monorepo çµæ§‹èªªæ˜

```
moonshot idea/
â”œâ”€â”€ apps/
â”‚   â””â”€â”€ web/              â† âœ… æ­£ç¢ºçš„æ‡‰ç”¨ç›®éŒ„
â”‚       â”œâ”€â”€ app/          â† Next.js é é¢
â”‚       â”œâ”€â”€ components/   â† React çµ„ä»¶ï¼ˆå·²åŒæ­¥ï¼‰
â”‚       â”‚   â””â”€â”€ solve/    â† âœ… æ–°å¢
â”‚       â”œâ”€â”€ lib/          â† å·¥å…·å‡½æ•¸ï¼ˆå·²åŒæ­¥ï¼‰
â”‚       â”‚   â””â”€â”€ solve-types.ts  â† âœ… æ–°å¢
â”‚       â””â”€â”€ package.json
â”‚
â””â”€â”€ app/                  â† âŒ èˆŠç›®éŒ„ï¼ˆå·²æ£„ç”¨ï¼Œè«‹å¿½ç•¥ï¼‰
```

**é‡è¦**: æ‰€æœ‰æœªä¾†çš„ä¿®æ”¹éƒ½æ‡‰è©²åœ¨ `apps/web/` ä¸­é€²è¡Œï¼

---

## ğŸš€ éƒ¨ç½²æª¢æŸ¥æ¸…å–®

### Local Development âœ…
- [x] é–‹ç™¼æœå‹™å™¨é‹è¡Œä¸­
- [x] Warmup API è¿”å› 410
- [x] ç§‘ç›®æª¢æ¸¬æ­£ç¢ºå·¥ä½œ
- [x] çµ„ä»¶å®Œæ•´åŒæ­¥
- [x] ç’°å¢ƒé…ç½®æ­£ç¢º

### User Verification â³
- [ ] ç€è¦½å™¨ç¡¬åˆ·æ–°å®Œæˆ
- [ ] è‹±æ–‡é¡Œç›®æ¸¬è©¦é€šé
- [ ] Console è¼¸å‡ºæ­£ç¢º
- [ ] UI é¡¯ç¤ºè©³è§£ï¼ˆä¸æ˜¯é¸æ“‡é¡Œï¼‰
- [ ] ç„¡éŒ¯èª¤è¨Šæ¯

### Production Deployment ğŸ“¦
- [ ] `pnpm run build` é€šé
- [ ] Linter ç„¡è­¦å‘Š
- [ ] E2E æ¸¬è©¦é€šé
- [ ] æ€§èƒ½é”æ¨™

---

## ğŸ” å¸¸è¦‹å•é¡Œ

### Q1: ä»ç„¶çœ‹åˆ°é¸æ“‡é¡Œï¼Ÿ

**A**: åŸ·è¡Œå®Œå…¨ç¡¬åˆ·æ–°
```bash
# æ¸…é™¤æ‰€æœ‰ç·©å­˜
DevTools â†’ Application â†’ Clear site data

# ç¡¬åˆ·æ–°
Mac: Cmd + Shift + R
Windows: Ctrl + Shift + F5

# æˆ–ä½¿ç”¨ç„¡ç—•æ¨¡å¼
Chrome: Cmd + Shift + N
```

---

### Q2: Console ä»é¡¯ç¤º [warmup-mcq]ï¼Ÿ

**A**: æª¢æŸ¥ URL å’Œæœå‹™å™¨ç‹€æ…‹
```bash
# 1. ç¢ºèª URL
âœ… http://localhost:3000/ask

# 2. æª¢æŸ¥æœå‹™å™¨
lsof -ti:3000

# 3. å¦‚éœ€è¦ï¼Œé‡å•Ÿæœå‹™å™¨
lsof -ti:3000 | xargs kill -9
pnpm run dev:web
```

---

### Q3: å‡ºç¾ç·¨è­¯éŒ¯èª¤ï¼Ÿ

**A**: æ¸…é™¤ç·©å­˜ä¸¦é‡æ–°ç·¨è­¯
```bash
# 1. æ¸…é™¤ .next ç›®éŒ„
rm -rf apps/web/.next

# 2. é‡æ–°å®‰è£ï¼ˆå¦‚éœ€è¦ï¼‰
pnpm install

# 3. é‡å•Ÿæœå‹™å™¨
pnpm run dev:web
```

---

## ğŸ“ é©—æ”¶å®Œæˆæ¨™æº–

ç•¶ç”¨æˆ¶ç¢ºèªä»¥ä¸‹æ‰€æœ‰é …ç›®å¾Œï¼Œå³å¯è¦–ç‚ºå®Œå…¨ä¿®å¾©ï¼š

```
âœ… ç¡¬åˆ·æ–°ç€è¦½å™¨å®Œæˆ
âœ… Console é¡¯ç¤º: Subject detection validated: english
âœ… UI é¡¯ç¤ºè©³è§£å¡ç‰‡ï¼ˆä¸æ˜¯é¸æ“‡é¡Œï¼‰
âœ… å…§å®¹æ˜¯è‹±æ–‡ç›¸é—œ
âœ… ç„¡æ•¸å­¸å…§å®¹
âœ… ç„¡ Console éŒ¯èª¤
```

---

## ğŸ‰ å®Œæˆç‹€æ…‹

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                        â•‘
â•‘  âœ… PLMS Solver-Only Mode å®Œå…¨å°±ç·’ï¼                    â•‘
â•‘                                                        â•‘
â•‘  ğŸ”§ å¾Œç«¯: å®Œæˆ                                         â•‘
â•‘  ğŸ“¦ çµ„ä»¶: å®Œæˆ                                         â•‘
â•‘  ğŸš« Warmup: ç¦ç”¨                                       â•‘
â•‘  ğŸ§ª æ¸¬è©¦: é€šé                                         â•‘
â•‘  ğŸ“š æ–‡æª”: å®Œæˆ                                         â•‘
â•‘  â³ ç”¨æˆ¶é©—è­‰: å¾…ç¢ºèª                                   â•‘
â•‘                                                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ“ ç•¶å‰ç‹€æ…‹

- **æ™‚é–“**: 2025-10-27T16:50:00+08:00
- **æœå‹™å™¨**: ğŸŸ¢ é‹è¡Œä¸­ (Port 3000)
- **ç€è¦½å™¨**: ğŸ”µ å·²æ‰“é–‹ http://localhost:3000/ask
- **ä¸‹ä¸€æ­¥**: **è«‹ç”¨æˆ¶ç¡¬åˆ·æ–°ç€è¦½å™¨ä¸¦æ¸¬è©¦è‹±æ–‡é¡Œç›®ï¼**

---

## ğŸš¦ å¿«é€Ÿé©—è­‰å‘½ä»¤

```bash
# æ¸…é™¤ä¸¦åˆ·æ–°
localStorage.clear(); sessionStorage.clear(); location.reload(true)
```

**æŒ‰ `Cmd + Shift + R` (Mac) ç¡¬åˆ·æ–°å¾Œï¼Œè¼¸å…¥è‹±æ–‡é¡Œç›®æ¸¬è©¦ï¼** ğŸ¯


