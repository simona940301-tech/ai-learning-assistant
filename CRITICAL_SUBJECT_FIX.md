# ğŸš¨ ç§‘ç›®æª¢æ¸¬å•é¡Œè¨ºæ–·èˆ‡ä¿®å¾©

**æ™‚é–“**: 2025-10-27T16:35:00  
**ç‹€æ…‹**: ğŸ” **è¨ºæ–·ä¸­**

---

## ğŸ“Š ç•¶å‰ç‹€æ³

### ç”¨æˆ¶å ±å‘Š
- âŒ è¼¸å…¥è‹±æ–‡é¡Œç›®æ™‚ï¼Œä»é¡¯ç¤º**æ•¸å­¸é¸é …**ï¼ˆé¤˜å¼¦å®šç†ç­‰ï¼‰
- âœ… ç’°å¢ƒé…ç½®æ­£ç¢º (`timezone=Asia/Taipei`)
- âœ… ä¼ºæœå™¨é‹è¡Œä¸­ (Port 3000)

### å·²å®Œæˆä¿®å¾©
1. âœ… ä¿®å¾© `lib/ai/hard-guard.ts` - æ·»åŠ  `g` flag åˆ°æ­£å‰‡è¡¨é”å¼
2. âœ… è¨ºæ–·è…³æœ¬é©—è­‰ - ç§‘ç›®æª¢æ¸¬**æ­£ç¢ºå·¥ä½œ**ï¼š
   ```
   English MCQ: 69.2% â†’ english âœ…
   Math Triangle: 80.0% â†’ math âœ…
   Chinese Reading: 57.5% â†’ chinese âœ…
   ```

---

## ğŸ” å•é¡Œåˆ†æ

### æˆªåœ–é¡¯ç¤º
ç”¨æˆ¶çœ‹åˆ°çš„ç•Œé¢æ˜¯**é¸æ“‡é¡Œæ ¼å¼**ï¼š
```
é¡Œç›®ï¼šThere are reports coming in...
å•é¡Œï¼šä¸‹åˆ—å“ªä¸€å€‹æè¿°æœ€ç¬¦åˆã€Œé¤˜å¼¦å®šç†ã€ï¼Ÿ
é¸é …ï¼š
  A: c^2=a^2+b^2-2ab cos C
  B: å¸¸è¦‹èª¤è§£ï¼šã€Œæ¢ä»¶å€’ç½®ã€
  C: å¸¸è¦‹èª¤è§£ï¼šã€ŒæŠŠè‡ªè®Šèˆ‡æ‡‰è®Šå°èª¿ã€
  D: å¸¸è¦‹èª¤è§£ï¼šã€ŒæŠŠå…§ç©ç•¶å¤–ç©ã€
```

### é—œéµç™¼ç¾
é€™å€‹ç•Œé¢**ä¸æ˜¯** `AnySubjectSolver` çš„è¼¸å‡ºï¼

**è­‰æ“š**:
1. `AnySubjectSolver` ç›´æ¥é¡¯ç¤º**è©³è§£å¡ç‰‡**ï¼Œä¸é¡¯ç¤ºé¸æ“‡é¡Œ
2. å•é¡Œæ–‡æœ¬ "ä¸‹åˆ—å“ªä¸€å€‹æè¿°æœ€ç¬¦åˆã€Œé¤˜å¼¦å®šç†ã€ï¼Ÿ" ä¾†è‡ª **Warmup API**
3. æŸ¥æ‰¾çµæœï¼šæ­¤æ–‡æœ¬ç”Ÿæˆåœ¨ `app/api/warmup/keypoint-mcq-simple/route.ts:196`

### å¯èƒ½åŸå› 
1. **ç€è¦½å™¨ç·©å­˜** - ç”¨æˆ¶çš„ç€è¦½å™¨é‚„åœ¨ä½¿ç”¨èˆŠä»£ç¢¼
2. **HMR å¤±æ•—** - Hot Module Replacement æ²’æœ‰åŠ è¼‰æ–°ä»£ç¢¼
3. **æ¸¬è©¦èˆŠé é¢** - ç”¨æˆ¶åœ¨æ¸¬è©¦å…¶ä»–èˆŠçš„ Warmup æµç¨‹é é¢
4. **æˆªåœ–æ˜¯èˆŠçš„** - æˆªåœ–ä¸æ˜¯ç•¶å‰æœ€æ–°æ¸¬è©¦çš„çµæœ

---

## ğŸ¯ é©—è­‰æ–¹æ³•

### æ–¹æ³• 1: æ¸…é™¤ç·©å­˜ä¸¦ç¡¬åˆ·æ–°

```bash
# ç€è¦½å™¨æ“ä½œ
1. æ‰“é–‹ DevTools (F12 æˆ– Cmd+Opt+I)
2. å³éµé»æ“Šåˆ·æ–°æŒ‰éˆ•
3. é¸æ“‡ "æ¸…ç©ºå¿«å–ä¸¦å¼·åˆ¶é‡æ–°æ•´ç†"

æˆ–

Mac: Cmd + Shift + R
Windows: Ctrl + Shift + F5
```

### æ–¹æ³• 2: æª¢æŸ¥ç•¶å‰é é¢ URL

åœ¨ç€è¦½å™¨åœ°å€æ¬„ç¢ºèªï¼š
```
âœ… æ­£ç¢º: http://localhost:3000/ask
âŒ éŒ¯èª¤: ä»»ä½•å…¶ä»– URL
```

### æ–¹æ³• 3: æŸ¥çœ‹ Console æ—¥èªŒ

åœ¨æäº¤è‹±æ–‡é¡Œç›®å¾Œï¼ŒConsole æ‡‰è©²é¡¯ç¤ºï¼š

```javascript
âœ… Guard: hard=none, experts=[english:0.69,...], chosen=english, ...
âœ… Subject detection validated: english
```

**å¦‚æœé¡¯ç¤º**:
```javascript
âŒ [warmup-mcq] Subject input: undefined â†’ Using: MathA
```

å‰‡èªªæ˜é‚„åœ¨ä½¿ç”¨èˆŠçš„ Warmup æµç¨‹ï¼

---

## ğŸ”§ ç«‹å³åŸ·è¡Œçš„æ“ä½œ

### Step 1: å®Œå…¨æ¸…é™¤ç€è¦½å™¨ç‹€æ…‹

```javascript
// åœ¨ç€è¦½å™¨ Console åŸ·è¡Œ
localStorage.clear()
sessionStorage.clear()
console.clear()
console.log('âœ… Storage cleared at', new Date().toLocaleTimeString())
```

### Step 2: ç¡¬åˆ·æ–°é é¢

```
Mac: Cmd + Shift + R
Windows: Ctrl + Shift + F5
Linux: Ctrl + F5
```

### Step 3: é‡æ–°è¼¸å…¥è‹±æ–‡é¡Œç›®

```
There are reports coming in that a number of people have been injured in a terrorist ___ . (A) access (B) supply (C) attack (D) burden
```

### Step 4: æª¢æŸ¥ Console è¼¸å‡º

**é æœŸçœ‹åˆ°**:
```javascript
[route-solver] ...
âœ… Guard: hard=none, experts=[english:0.69,...], chosen=english
âœ… Subject detection validated: english
âœ… Solve preview updated ...
```

**ä¸æ‡‰è©²çœ‹åˆ°**:
```javascript
[warmup-mcq] Subject input: undefined â†’ Using: MathA  âŒ
```

---

## ğŸ§ª æ¸¬è©¦ç•¶å‰ä»£ç¢¼ç‹€æ…‹

### å¾Œç«¯æ¸¬è©¦ï¼ˆå·²é€šé âœ…ï¼‰

```bash
$ npx tsx scripts/test-subject-detection.ts

âœ… English MCQ: 69.2% â†’ english
âœ… Math Triangle: 80.0% â†’ math
âœ… Chinese Reading: 57.5% â†’ chinese
```

### å‰ç«¯æ¸¬è©¦ï¼ˆå¾…é©—è­‰ â³ï¼‰

ç”¨æˆ¶éœ€è¦ï¼š
1. ç¡¬åˆ·æ–°ç€è¦½å™¨
2. é‡æ–°æäº¤è‹±æ–‡é¡Œç›®
3. æª¢æŸ¥ Console æ—¥èªŒ
4. æˆªåœ–å›å ±çµæœ

---

## ğŸ“‹ è¨ºæ–·æª¢æŸ¥æ¸…å–®

### å¾Œç«¯ç‹€æ…‹
- [x] âœ… `lib/ai/hard-guard.ts` å·²ä¿®å¾©ï¼ˆæ·»åŠ  `/g` flagï¼‰
- [x] âœ… ç§‘ç›®æª¢æ¸¬é‚è¼¯é©—è­‰é€šé
- [x] âœ… é–‹ç™¼ä¼ºæœå™¨é‹è¡Œä¸­ (Port 3000)
- [x] âœ… API ç«¯é»å¯è¨ªå•

### å‰ç«¯ç‹€æ…‹
- [ ] â³ ç€è¦½å™¨ç·©å­˜å·²æ¸…é™¤
- [ ] â³ é é¢å·²ç¡¬åˆ·æ–°
- [ ] â³ HMR åŠ è¼‰æ–°ä»£ç¢¼
- [ ] â³ Console é¡¯ç¤ºæ­£ç¢ºçš„ç§‘ç›®æª¢æ¸¬æ—¥èªŒ

### ç”¨æˆ¶æ¸¬è©¦
- [ ] â³ è¼¸å…¥è‹±æ–‡é¡Œç›®
- [ ] â³ æª¢æŸ¥æ˜¯å¦é¡¯ç¤ºè‹±æ–‡ç›¸é—œçš„è©³è§£
- [ ] â³ ç¢ºèªä¸å†é¡¯ç¤ºæ•¸å­¸é¸é …
- [ ] â³ Console ç„¡éŒ¯èª¤è¨Šæ¯

---

## ğŸ¯ é æœŸçµæœ

### æˆåŠŸæ¨™æº–

ç•¶ç”¨æˆ¶è¼¸å…¥è‹±æ–‡é¡Œç›®å¾Œï¼š

1. **Console æ—¥èªŒ**:
```javascript
âœ… Guard: hard=none, experts=[english:0.69,...], chosen=english
âœ… Subject detection validated: english
```

2. **UI é¡¯ç¤º**:
   - âœ… é¡¯ç¤º**è‹±æ–‡è©³è§£**å¡ç‰‡
   - âœ… **ä¸é¡¯ç¤º**é¸æ“‡é¡Œç•Œé¢
   - âœ… **ä¸é¡¯ç¤º**æ•¸å­¸ç›¸é—œå…§å®¹

3. **é é¢çµæ§‹**:
   - âœ… é ‚éƒ¨æœ‰ [è©³è§£ï½œç›¸ä¼¼é¡Œï½œé‡é»] ä¸‰å€‹ Tab
   - âœ… å…§å®¹å€åŸŸé¡¯ç¤ºè©³è§£å¡ç‰‡
   - âœ… åº•éƒ¨æœ‰å›ºå®šçš„è¼¸å…¥æ¡†

### å¤±æ•—æ¨™æº–

å¦‚æœä»ç„¶é¡¯ç¤ºï¼š
- âŒ é¸æ“‡é¡Œç•Œé¢ï¼ˆ"ä¸‹åˆ—å“ªä¸€å€‹æè¿°æœ€ç¬¦åˆ...ï¼Ÿ"ï¼‰
- âŒ æ•¸å­¸é¸é …ï¼ˆé¤˜å¼¦å®šç†ç­‰ï¼‰
- âŒ Console é¡¯ç¤º `[warmup-mcq]` æ—¥èªŒ

å‰‡èªªæ˜ï¼š
- âŒ ç€è¦½å™¨ç·©å­˜æœªæ¸…é™¤
- âŒ æˆ– HMR å¤±æ•—
- âŒ æˆ–ç”¨æˆ¶åœ¨æ¸¬è©¦éŒ¯èª¤çš„é é¢/æµç¨‹

---

## ğŸ”„ å¾ŒçºŒæ­¥é©Ÿ

### å¦‚æœç¡¬åˆ·æ–°å¾Œä»æœ‰å•é¡Œ

1. **å®Œå…¨é‡å•Ÿç€è¦½å™¨**
```bash
é—œé–‰æ‰€æœ‰ç€è¦½å™¨è¦–çª—
é‡æ–°æ‰“é–‹ç€è¦½å™¨
è¨ªå• http://localhost:3000/ask
```

2. **é‡å•Ÿé–‹ç™¼ä¼ºæœå™¨**
```bash
# åœæ­¢ç•¶å‰ä¼ºæœå™¨
lsof -ti:3000 | xargs kill -9

# é‡æ–°å•Ÿå‹•
pnpm run dev:web
```

3. **ä½¿ç”¨ç„¡ç—•æ¨¡å¼æ¸¬è©¦**
```bash
Chrome: Cmd+Shift+N (Mac) / Ctrl+Shift+N (Windows)
Safari: Cmd+Shift+N
Firefox: Cmd+Shift+P
```

---

## ğŸ“ å›å ±æ ¼å¼

### æˆåŠŸå›å ±
```
âœ… ç¡¬åˆ·æ–°å¾Œå•é¡Œå·²è§£æ±º
âœ… Console é¡¯ç¤º: Subject detection validated: english
âœ… é é¢é¡¯ç¤ºè‹±æ–‡è©³è§£ï¼Œæ²’æœ‰æ•¸å­¸å…§å®¹
```

### å•é¡Œå›å ±
```
âŒ ç¡¬åˆ·æ–°å¾Œä»æœ‰å•é¡Œ
Console æ—¥èªŒ: [è¤‡è£½è²¼ä¸Šç›¸é—œæ—¥èªŒ]
æˆªåœ–: [æä¾›æ–°çš„æˆªåœ–]
```

---

## ğŸ‰ ä¿®å¾©ç‹€æ…‹

| é …ç›® | ç‹€æ…‹ | å‚™è¨» |
|------|------|------|
| Hard Guard Bug | âœ… å·²ä¿®å¾© | æ·»åŠ  `/g` flag |
| å¾Œç«¯ç§‘ç›®æª¢æ¸¬ | âœ… é©—è­‰é€šé | è‹±æ–‡69%, æ•¸å­¸80% |
| ç’°å¢ƒé…ç½® | âœ… å®Œæˆ | timezone=Asia/Taipei |
| å‰ç«¯åŠ è¼‰æ–°ä»£ç¢¼ | â³ å¾…ç¢ºèª | éœ€ç”¨æˆ¶ç¡¬åˆ·æ–° |
| E2E æ¸¬è©¦ | â³ å¾…åŸ·è¡Œ | ç­‰å¾…å‰ç«¯ç¢ºèª |

---

**ç•¶å‰è¡Œå‹•**: è«‹ç”¨æˆ¶åŸ·è¡Œ**å®Œå…¨ç¡¬åˆ·æ–°**ä¸¦é‡æ–°æ¸¬è©¦è‹±æ–‡é¡Œç›®

**å¿«é€Ÿå‘½ä»¤**: `Cmd + Shift + R` (Mac) / `Ctrl + Shift + F5` (Windows)


